<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ’Œ Love Letter â€“ Lobby</title>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="stylesheet" href="/css/index.css">
</head>
<body>

<h1>ğŸ’Œ Love Letter (2â€“6 joueurs)</h1>

<div id="login">
  <input id="nameInput" placeholder="Ton pseudo" />
  <button onclick="setName()">Rejoindre</button>
</div>

<div id="lobby" style="display:none;">
  <h2>Lobby</h2>
  <div id="players"></div>
  <button id="readyBtn" onclick="ready()">âœ… PrÃªt</button>
</div>

<div id="game" style="display:none;">
  <h2>ğŸ® Partie en cours</h2>
  <p>La partie a commencÃ© !</p>
</div>

<script>
  const socket = io();
  let myId = null;
  let isReady = false;

  socket.on("connect", () => {
    myId = socket.id;
  });

  function setName() {
    const name = document.getElementById("nameInput").value.trim();
    if (!name) return alert("Entre un pseudo");
    socket.emit("setName", name, (res) => {
      if (!res || !res.ok) {
        return alert(res && res.error ? res.error : "Erreur lors de la mise Ã  jour du pseudo");
      }
      document.getElementById("login").style.display = "none";
      document.getElementById("lobby").style.display = "block";
    });
  }

  function ready() {
    socket.emit("ready");
    isReady = !isReady;
    document.getElementById("readyBtn").innerHTML = isReady ? "âŒ Ne plus Ãªtre prÃªt" : "âœ… PrÃªt";
  }

  socket.on("state", game => {
    if (game.started) {
      document.getElementById("lobby").style.display = "none";
      document.getElementById("game").style.display = "block";
      return;
    }

    const div = document.getElementById("players");
    div.innerHTML = "";

    game.players.forEach(p => {
      const line = document.createElement("div");
      line.className = "player" + (p.id === myId ? " me" : "");
      line.innerHTML = `
        ${p.name || "Sans pseudo"}
        <span class="${p.ready ? "ready" : "not-ready"}">
          ${p.ready ? "âœ” PrÃªt" : "â³ Pas prÃªt"}
        </span>
        ${p.id === myId ? " ğŸ‘ˆ toi" : ""}
      `;
      div.appendChild(line);
    });
  });

  // Chat toggle (affiche/masque l'iframe)
  function toggleChat() {
    const frame = document.getElementById('chatFrame');
    const btn = document.getElementById('chatToggle');
    if (!frame || !btn) return;
    const hidden = frame.style.display === 'none';
    frame.style.display = hidden ? 'block' : 'none';
    btn.textContent = hidden ? 'âœ–' : 'ğŸ’¬';
  }
</script>

<!-- Chat intÃ©grÃ© (utilise message.html) -->
<button id="chatToggle" aria-label="Toggle chat" onclick="toggleChat()">âœ–</button>
<iframe id="chatFrame" src="/html/message.html" title="Chat" frameborder="0"></iframe>

</body>
</html>
